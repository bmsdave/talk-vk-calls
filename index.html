<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<section>
						видео звонки в вебе на 2000+ участников<br/>
						Вадим Горбачев<br/>
						команда VK calls
					</section>
	
					<section>
						Статистика<br/>
						TBD
						<aside class="notes">
							1. сколько людей пользуются звонками
						</aside>
					</section>
				</section>

				<section>
					<section data-background-color='#2D1674'>
						Оглавление введения:
						<ul>
							<li>что такое webrtc</li>
							<li>топологии звонков</li>
							<li>из чего состоит видео (кадры опорники)</li>
							<li>кодеки (h.264, vp9, av1)</li>
							<li>webcodecs</li>
							<li>особенности safari</li>
							<li>функциональность звонков</li>
						</ul>
					
					</section>
	
					<section data-background-color='#2D1674'>
						что такое webrtc<br/>
						<ul>
							<li>захват видео/аудио</li>
							<li>установка соединения</li>
							<li>передача данных</li>
						</ul><br/>
						TBD схема с сигналингом STUN TURN и пр.
					</section>
	
					<section data-background-color='#2D1674'>
						топологии звонков<br/>
						<img src="images/topology.png" alt="topology">
					</section>
	
					<section data-background-color='#2D1674'>
						из чего состоит видео<br/>
						<img src="images/video-frames.png" alt="video-frames">
					</section>
	
					<section data-background-color='#2D1674'>
						кодеки VP9, h.264 и пр.<br/>
						TBD график с производительность/качество
						<img src="images/codecs.png" alt="codecs">
					</section>
	
					<section data-background-color='#2D1674'>
						webcodecs<br/>
						TBD краткое описание API
					</section>
	
					<section data-background-color='#2D1674'>
						особенности safari<br/>
						TBD про боль и про репутацию
					</section>
	
					<section data-background-color='#2D1674'>
						функциональность звонков
						<ul>
							<li>аудио, видео, скриншара</li>
							<li>грид, оратор, колбаса, свернутый звонок</li>
							<li>режим админа, поднятие руки</li>
							<li>трансляции</li>
						</ul>
						<img src="images/func-call.png" height="400px">
					</section>	
				</section>
				
				<section>
					<section data-background-color='#000C66'>
						Завязка. Первая версия звонков на 100
						<img src="images/1-arch.jpg" alt="1-arch">
					</section>
	
					<section data-background-color='#000C66'>
						Проблемы (оглавление завязки)
						<ul>
							<li>браузеры не выдерживают больше 50 видео.</li>
							<li>слишком большая нагрузка на сеть</li>
							<li>страдающая анимация</li>
							<li>частные перерисовки (так как много активности)</li>
						</ul>
					</section>
	
					<section data-background-color='#000C66'>
						Решение. audio mix
						<img src="images/audio-mix.png" alt="audio-mix">
					</section>
	
					<section data-background-color='#000C66'>
						Решение. видео по запросу<br/>
						<img src="images/video-on-demand-1.jpg" height="600px" alt="video-on-demand-1">
					</section>
	
					<section data-background-color='#000C66'>
						Решение. видео по запросу<br/>
						<img src="images/video-on-demand-2.jpg" height="600px" alt="video-on-demand-2">
					</section>
	
					<section data-background-color='#000C66'>
						Решение. качество по запросу<br/>
						<img src="images/qualiti-on-demand.jpg" height="600px">
					</section>
	
					<section data-background-color='#000C66'>
						Решение. запрос key frame<br/>
						<img src="images/key-frame-on-demand.jpg" height="600px">
					</section>
	
					<section data-background-color='#000C66'>
						Решение. intersection Observer (ошибка)
						<img src="images/intersection-observer.jpg" height="600px">
					</section>	
				</section>

				<section>
					<section data-background-color='#05445E'>
						[Развитие] Итог развязки<br/>
						оптимизированный звонок на 100<br/>
						[TBD] две картинки сравнения + сравнение по ресурсам сети, CPU
					</section>
					
					<section data-background-color='#05445E'>
						про UX
						<ul>
							<li>Отсутсвие индикации плохой сети</li>
							<li>данные по сигналингу и стримы не всегда приходят синхронно</li>
							<li>некоторые анимированные отрисовки сильно тормозили</li>
							<li>при запросе видео с сервера, оно могло приходить очень долго в плоть до 10 секунд</li>
							<li>"мылилась" скриншара</li>
						</ul> 
					</section>
	
					<section data-background-color='#05445E'>
						Работа в плохой сети<br/>
						[TODO] узнать про плохую сеть, как определяется
					</section>
	
					<section data-background-color='#05445E'>
						datachannel и синхронизация <br/>
						[TBD] картинка с рассинхроном зеленой рамки и говорения
						<img src="images/datachannel.jpg" height="500px">
					</section>
	
					<section data-background-color='#05445E'>
						blur карточек<br/>
						[TBD] картинка с блюром и графиками перформанса<br/>
						[TBD] после переписывания на градиент
					</section>
	
					<section data-background-color='#05445E'>
						скриншара<br/>
						[TBD] стоит ли про это рассказывать? Если да, поспрашивать Колю как работает<br/>
						<img src="images/screenshare.svg" height="500px">
					</section>	
				</section>
				
				<section>
					<section data-background-color='#1A5653'>
						[кульминация] итог оптимизации по UX на 100.<br/>
						[TBD] две картинки сравнения + сравнение по ресурсам сети, CPU<br/>
					</section>
	
					<section data-background-color='#1A5653'>
						оглавление на переход на 2000+<br/>
						<ul>
							<li>выходили за лимит хрома по webMediaPalayer</li>
							<li>дорого рисовать 2000 карточек</li> 
							<li>долго собирать данные о всех пользователях на старте</li>
						</ul>
					</section>
	
					<section data-background-color='#1A5653'>
						видео слоты<br>
						<img src="images/slots.jpg" height="600px">
					</section>
	
					<section data-background-color='#1A5653'>
						хранение DOM элемента вместо stream
						<img src="images/dom.jpg" height="600px">
					</section>
	
					<section data-background-color='#1A5653'>
						группировка событий (батчинг)<br/>
						<ul>
							<li>на старте одно событие с слепком состояния звонка</li>
							<li>события идут через throttle/debounce</li>
						</ul><br/>
						<img src="images/batch.jpg" height="400px">
					</section>
	
					<section data-background-color='#1A5653'>
						infinity scroll<br/>
						<img src="images/infinity-scroll.jpg" height="600px">
					</section>
	
					<section data-background-color='#1A5653'>
						получение данных с сервера по запросу
						<ul>
							<li>список видимых карточек</li>
							<li>список имен кто говорит</li>
							<li>серверный поиск участников</li>
						</ul>
					</section>
	
					<section data-background-color='#1A5653'>
						[развязка] демонстрация звонков на 6000+<br/>
						+ итоги кульминации<br/>
						видео с звонком на 6к
					</section>	
				</section>
				
				<section>
					<section data-background-color='#613659'>
						[глобальный вывод]
						<ul>
							<li>экспериментируйте</li>
							<li>webrtc хорош для p2p, но с групповыми нужно будет повозиться</li>	
							<li>берите на килент только те данные которые показываете именно сейчас</li>
						</ul>
					</section>
	
					<section data-background-color='#613659'>
						философия<br/>
						создание звонков больше напоминает gamedev нежели веб-разработку
					</section>
	
					<section data-background-color='#613659'>
						SDK и приглашение в команду
					</section>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
